1
00:00:00,000 --> 00:00:06,410
好 我們說另外一種來偵測這個botnet的方式

2
00:00:06,410 --> 00:00:08,780
就是我們叫做臥底

3
00:00:08,780 --> 00:00:14,110
臥底的意思就是說 我們讓電腦就成為botnet的一份子

4
00:00:14,110 --> 00:00:16,210
就讓我們的電腦成為bot

5
00:00:16,210 --> 00:00:19,480
他去看看說到底是跟誰聯絡

6
00:00:19,480 --> 00:00:22,280
他bot到底有哪一些 就相當於所謂的臥底

7
00:00:22,280 --> 00:00:26,310
那臥底就是說讓某些電腦 就是我們的電腦

8
00:00:26,310 --> 00:00:32,210
成為bot的一份子 來刺探這個整個botnet的一些軍情

9
00:00:32,210 --> 00:00:36,750
問題是說那我們怎麼讓我們的這個電腦成為bot

10
00:00:36,750 --> 00:00:39,010
當然就是要去故意執行這個bot

11
00:00:39,010 --> 00:00:42,950
所以第一個做法就是說 我們直接執行bot的惡意程式

12
00:00:42,950 --> 00:00:47,280
看他跟誰聯絡 當然這個有風險

13
00:00:47,280 --> 00:00:50,410
因為如果這個bot程式你直接把它安裝進來

14
00:00:50,410 --> 00:00:51,710
你就成為一個bot

15
00:00:51,710 --> 00:00:55,950
然後如果他做了破壞 那你這個電腦就被破壞掉了

16
00:00:55,950 --> 00:00:59,880
所以通常這個需要做一些所謂的保護機制

17
00:00:59,880 --> 00:01:02,710
譬如說你可能是在virtual machine上面

18
00:01:02,710 --> 00:01:04,380
把這個bot執行起來

19
00:01:04,380 --> 00:01:06,680
可是現在的bot非常的聰明

20
00:01:06,680 --> 00:01:09,310
他覺得說如果你是在一個sandbox

21
00:01:09,310 --> 00:01:11,980
就是說 你是在一個虛擬的環境之下執行它

22
00:01:11,980 --> 00:01:16,410
他就不啟動 現在bot非常的聰明

23
00:01:16,410 --> 00:01:20,010
他有點像說反偵測的這個技術

24
00:01:20,010 --> 00:01:22,350
就如果你想觀察他 他就不動

25
00:01:22,350 --> 00:01:24,980
這個是有一點越來越難

26
00:01:24,980 --> 00:01:28,380
不過基本上就是說 臥底的概念就是說

27
00:01:28,380 --> 00:01:31,450
我們把bot在我們電腦上面執行起來

28
00:01:31,450 --> 00:01:34,910
然後我們來看看說 他到底跟誰聯絡

29
00:01:34,910 --> 00:01:37,880
因為我們要知道他的master是誰

30
00:01:37,880 --> 00:01:42,910
那另外一個就是說 我們故意使用有弱點的主機

31
00:01:42,910 --> 00:01:45,050
就是我們這邊架了

32
00:01:45,050 --> 00:01:48,550
所謂的一般我們叫做蜜罐(honeypot)

33
00:01:48,550 --> 00:01:51,510
就是這個罐子裡面裝了一些蜜

34
00:01:51,510 --> 00:01:55,510
因為我們要誘捕這個所謂的駭客的意思

35
00:01:55,510 --> 00:01:57,950
所以我們這邊架了一些

36
00:01:57,950 --> 00:02:02,350
我們說叫做誘餌機 就Honeypot

37
00:02:02,350 --> 00:02:03,880
就相當於一個蜜罐

38
00:02:03,880 --> 00:02:06,050
這些電腦都是我們的主機

39
00:02:06,050 --> 00:02:08,580
但是我們故意放一些漏洞

40
00:02:08,580 --> 00:02:11,610
就是我們故意把漏洞沒有補起來

41
00:02:11,610 --> 00:02:15,150
然後放一些所謂的誘餌

42
00:02:15,150 --> 00:02:16,680
譬如說我放到一些資料庫啦

43
00:02:16,680 --> 00:02:21,350
放到一些什麼看起來好像很有興趣的data啦

44
00:02:21,350 --> 00:02:23,280
很敏感的數據等等放在這上面

45
00:02:23,280 --> 00:02:26,780
然後故意把漏洞把它打開

46
00:02:26,780 --> 00:02:32,250
然後這個駭客在Internet上面他就會開始來掃描

47
00:02:32,250 --> 00:02:34,450
他會從這樣

48
00:02:34,450 --> 00:02:36,580
譬如他這邊到這邊掃瞄到這裡說

49
00:02:36,580 --> 00:02:40,680
發現這台電腦有漏洞

50
00:02:40,680 --> 00:02:43,380
那他就可能會把它的惡意程式

51
00:02:43,380 --> 00:02:45,010
就植入到這個電腦裡面來

52
00:02:45,010 --> 00:02:48,210
那你這個電腦如果被植入之後

53
00:02:48,210 --> 00:02:51,280
他就成為所謂的bot

54
00:02:51,280 --> 00:02:53,080
那他就會開始去跟

55
00:02:53,080 --> 00:02:56,380
我們講他會跟外面的bot master去聯繫

56
00:02:56,380 --> 00:02:57,980
因為你成為bot了

57
00:02:57,980 --> 00:02:59,980
那我們到底在做什麼

58
00:02:59,980 --> 00:03:02,010
因為我們還有一個很重要的地方

59
00:03:02,010 --> 00:03:03,510
就是這個地方 側錄

60
00:03:03,510 --> 00:03:06,980
所以我們會在這個網路上面

61
00:03:06,980 --> 00:03:09,450
安裝這個所謂的側錄設備

62
00:03:09,450 --> 00:03:11,280
還有側錄的資料庫

63
00:03:11,280 --> 00:03:14,450
所以當我們把這個Honeypot打開之後

64
00:03:14,450 --> 00:03:19,180
所有進來掃描的啦、建連線的啦

65
00:03:19,180 --> 00:03:23,810
甚至植入這個惡意程式 這個所有的過程

66
00:03:23,810 --> 00:03:27,950
這個側錄的設備通通會把它側錄下來

67
00:03:27,950 --> 00:03:30,580
然後再去分析這邊所有的流量

68
00:03:30,580 --> 00:03:32,050
設法找到說

69
00:03:32,050 --> 00:03:35,150
第一個 這個可能是bot來找他

70
00:03:35,150 --> 00:03:37,650
第二個這個可能是bot master

71
00:03:37,650 --> 00:03:39,310
所以我們可以找到說

72
00:03:39,310 --> 00:03:42,980
到底是哪個bot來找我們這個所謂的蜜罐

73
00:03:42,980 --> 00:03:44,450
進來蜜罐 或者說

74
00:03:44,450 --> 00:03:49,580
我們這個被用弱點植入這個惡意程式的這個主機

75
00:03:49,580 --> 00:03:54,780
他怎麼樣去跟外面的這個所謂的bot master溝通

76
00:03:54,780 --> 00:03:57,410
這個所有的過程通通把他錄下來

77
00:03:57,410 --> 00:03:59,810
就變成說我們用臥底的方式

78
00:03:59,810 --> 00:04:06,210
那我們來看一下過去一些這個所謂的Honeypot

79
00:04:06,210 --> 00:04:08,480
常常發現的一些案例

80
00:04:08,480 --> 00:04:10,510
譬如說我們可以發現像

81
00:04:10,510 --> 00:04:13,550
這個都是側錄的流量

82
00:04:13,550 --> 00:04:15,450
側錄流量裡面我們發現說

83
00:04:15,450 --> 00:04:17,880
這裡有一個攻擊

84
00:04:17,880 --> 00:04:23,580
他打的這個IP就是72.10.162.2

85
00:04:23,580 --> 00:04:25,610
這個剛好是在印尼的一個網站

86
00:04:25,610 --> 00:04:29,210
就是我們側錄到說 這裡被下了一個命令

87
00:04:29,210 --> 00:04:31,850
就去攻擊 這個是UDP的flooding

88
00:04:31,850 --> 00:04:33,650
做UDP的攻擊

89
00:04:33,650 --> 00:04:35,280
這個也是從側錄的流量裡面

90
00:04:35,280 --> 00:04:38,080
發現說有哪一些受害者

91
00:04:38,080 --> 00:04:40,580
那我們慢慢地把這些觀察的資料

92
00:04:40,580 --> 00:04:42,880
做分析、整理之後

93
00:04:42,880 --> 00:04:45,250
就有機會找到攻擊者

94
00:04:45,250 --> 00:04:46,950
或者所謂的master

95
00:04:46,950 --> 00:04:47,910
這是第一個例子

96
00:04:47,910 --> 00:04:49,150
那第二個例子就是說

97
00:04:49,150 --> 00:04:51,280
我們在這觀察的封包裡面

98
00:04:51,280 --> 00:04:55,380
我們發現說這裡有一個叫做IP Fragmented

99
00:04:55,380 --> 00:04:58,810
因為我們這個封包都被切割了

100
00:04:58,810 --> 00:05:01,380
然後他用UDP

101
00:05:01,380 --> 00:05:05,080
然後source port是所謂的1767

102
00:05:05,850 --> 00:05:07,050
這裡有一個source port

103
00:05:07,050 --> 00:05:12,310
然後有一個destination port 就是1145的攻擊

104
00:05:12,310 --> 00:05:16,080
就是我們從側錄下來的這個封包

105
00:05:16,080 --> 00:05:18,980
發現說這裡有一個發動的攻擊

106
00:05:18,980 --> 00:05:22,250
是用UDP、Source port、Destination port

107
00:05:22,250 --> 00:05:24,380
可是這個UDP在攻擊的時候

108
00:05:24,380 --> 00:05:27,510
會被切成很多小片段的IP的封包

109
00:05:27,510 --> 00:05:29,280
我們叫做IP Fragmented

110
00:05:29,280 --> 00:05:31,480
那這樣我們也大概知道說

111
00:05:31,480 --> 00:05:33,880
是誰發動攻擊的

112
00:05:33,880 --> 00:05:39,610
我們這裡把IP就先把它蓋掉 隱私權的關係

113
00:05:39,610 --> 00:05:43,780
也就是說我們從這個側錄的結果

114
00:05:43,780 --> 00:05:45,850
是可以找到一些蛛絲馬跡

115
00:05:45,850 --> 00:05:48,350
然後再開始去追朔

116
00:05:48,350 --> 00:05:50,750
這些IP有沒有什麼問題

117
00:05:50,750 --> 00:05:53,610
去查一下他是不是所謂的黑名單

118
00:05:53,610 --> 00:05:57,650
是不是有問題的IP 我們再來看要怎麼處理

119
00:05:57,650 --> 00:06:00,610
也就是說這個Botnet的偵測

120
00:06:00,610 --> 00:06:02,650
我們透過這兩種方式

121
00:06:02,650 --> 00:06:06,750
一個就是所謂的蜜罐 這個蜜罐本身我們叫做Honeypot

122
00:06:06,750 --> 00:06:09,280
還有一個就是流量的分析

123
00:06:09,280 --> 00:06:11,410
我們通常可以得到第一個

124
00:06:11,410 --> 00:06:16,880
得到清楚知道說這個C&C通訊流量的特徵

125
00:06:16,880 --> 00:06:20,010
我們知道因為我們都有把它側錄下來

126
00:06:20,010 --> 00:06:23,650
然後知道說這個C&C通訊流量的一個特徵

127
00:06:23,650 --> 00:06:27,850
第二個我們知道他怎麼樣入侵 他的手法是什麼

128
00:06:27,850 --> 00:06:34,550
第三個知道說駭客從哪裡來、我們的Bot跟誰聯絡

129
00:06:34,550 --> 00:06:37,050
因為我們會觀察到那些IP

130
00:06:37,050 --> 00:06:41,810
那根據這些搜集到的資訊我們就可以做防治

131
00:06:41,810 --> 00:06:44,050
譬如說如果你有這些IP

132
00:06:44,050 --> 00:06:49,810
就把這個IP就把他列入所謂的IP網址的一個黑名單

133
00:06:49,810 --> 00:06:53,250
一般防火牆裡面有一個ACL

134
00:06:53,250 --> 00:06:57,110
我可以把這些IP 可能不只一個 可能是好幾個

135
00:06:57,110 --> 00:07:00,210
所以把這個IP網址的清單放到防火牆裡面

136
00:07:00,210 --> 00:07:01,810
他就可以把他擋下來

137
00:07:01,810 --> 00:07:03,380
也就是說我們就阻擋了

138
00:07:03,380 --> 00:07:07,480
這個bot跟他的bot master溝通的這個管道

139
00:07:07,480 --> 00:07:09,710
也就是說我們知道這些訊息

140
00:07:09,710 --> 00:07:13,410
可以偵測或阻擋已知的這個通訊的流量

141
00:07:13,410 --> 00:07:14,980
你可以把它阻斷掉

142
00:07:14,980 --> 00:07:21,180
至少說 你讓他沒有辦法跟現在的這個master溝通

143
00:07:21,180 --> 00:07:24,780
當然他們可能還有各種方式來規避 那這是第一個

144
00:07:24,780 --> 00:07:29,950
那我們說這個不管是用蜜罐的方式

145
00:07:29,950 --> 00:07:33,550
還是用所謂的流量分析的方式

146
00:07:33,550 --> 00:07:38,680
他都會面臨的所謂的困難或者挑戰在哪裡

147
00:07:38,680 --> 00:07:43,680
第一個就是說這個bot master跟這個C&C Server

148
00:07:43,680 --> 00:07:47,310
或者C&C Server跟這個bot溝通 不管是P2P

149
00:07:51,710 --> 00:07:51,750
他們可能會加密 因為這是很容易的

150
00:07:51,750 --> 00:07:57,250
他加密 加密之後呢 我們可能就看不懂裡面的指令

151
00:07:57,250 --> 00:07:59,750
譬如說我現在要攻擊 我要掃描

152
00:07:59,750 --> 00:08:03,880
這些我們就變成看不懂了 因為它變成加密了

153
00:08:03,880 --> 00:08:08,280
所以加密就會大大的增加這個所謂的偵測的困難度

154
00:08:08,280 --> 00:08:11,380
第二個就是說他的架構是如果P2P

155
00:08:11,380 --> 00:08:13,210
或者Random的架構

156
00:08:13,210 --> 00:08:15,850
那P2P本身這個也很不容易偵測

157
00:08:15,850 --> 00:08:19,350
因為P2P在現今的網路上面就非常非常多

158
00:08:19,350 --> 00:08:20,580
各式各樣的P2P都在跑

159
00:08:20,580 --> 00:08:23,210
那他可能利用自己開發的P2P

160
00:08:23,210 --> 00:08:28,910
可能利用現成的P2P 讓你看起來他就是一個P2P的應用

161
00:08:28,910 --> 00:08:31,810
可是他在裡面送這些command 可是我們也不知道

162
00:08:31,810 --> 00:08:34,680
就更不容易的去追蹤

163
00:08:34,680 --> 00:08:38,380
那另外他也可能偽裝成別的通訊的protocol

164
00:08:38,380 --> 00:08:43,050
譬如說他可能偽裝成TCP 或者HTTP的port 80

165
00:08:43,050 --> 00:08:45,250
就是TCP的port 80

166
00:08:45,250 --> 00:08:48,510
好像他是在瀏覽網頁 也就是說

167
00:08:48,510 --> 00:08:50,510
他們溝通的管道可能變成

168
00:08:50,510 --> 00:08:55,210
加密或者偽裝成P2P或者偽裝成HTTP

169
00:08:55,210 --> 00:08:59,950
讓你看起來說他就是HTTP瀏覽網頁的流量

170
00:08:59,950 --> 00:09:03,310
事實上他不是在瀏覽網頁 他在做下命令

171
00:09:03,310 --> 00:09:07,680
就是說 命令的溝通 變成說如果他加了密

172
00:09:07,680 --> 00:09:11,410
或者利用所謂的P2P、利用HTTP

173
00:09:11,410 --> 00:09:13,280
這個都很難追了

174
00:09:13,280 --> 00:09:17,210
變成說在這個大量的這個流量裡面

175
00:09:17,210 --> 00:09:19,610
怎麼去找到他很不一樣的地方

176
00:09:19,610 --> 00:09:22,280
這個就變成說它的難度就增加

177
00:09:22,280 --> 00:09:24,180
也是一個非常大的挑戰

178
00:09:24,180 --> 00:09:26,180

